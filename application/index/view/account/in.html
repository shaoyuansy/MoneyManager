{layout name="layout"}
<style>
.form-group,
.form-horizontal,
.style-form{
	margin-left:0px;
	margin-right:0px;
	margin-buttom:0px;
	margin-top:0px;
	margin:0px;
	padding-left:0px;
	padding-right:0px;
	padding-top:0px;
	padding-buttom:0px;
	padding:0px;
}
.form-control{
	height: 26px;
    padding: 6px 6px;
}
.in-filter{
	margin-top:10px;
}
.save-in{
	position:absolute;
	right:15px;
	bottom:2px;
	height:25px;
	width:70px;
	padding: 2px 6px;
}
.content-panel{
	padding:10px;
}
.select{
	padding:0px;
}
label{
	margin-bottom: 0px;
	cursor:pointer;
}
.table,
.table thead tr th{
	text-align:center;
}
.toolbar{
	width:100px;
	height:30px;
	color:red;
}
</style>
    <section id="main-content">
          <section class="wrapper">
          	<h3><i class="fa fa-angle-right"></i> 收入</h3>
          	<!-- BASIC FORM ELELEMNTS -->
          	<div class="row mt">
          		<div class="col-lg-12 col-md-12 col-sm-12">
                    <div class="content-panel">
                        <form class="form-horizontal style-form row" id="income-form">
						    <div class="col-lg-3 col-md-3 col-sm-12" style="padding-left:0px;padding-right:0px;">
								<p class="centered" style="margin:0px;">
									<img src="/static/img/ui-sam.jpg" class="img-circle">
								</p>
						    </div>
						    <div class="row col-lg-9 col-md-9 col-sm-12 in-filters" >
							    <div class="form-group in-filter row col-lg-4 col-md-4 col-sm-12" 
									 style="border-bottom: 0px;padding-bottom: 0px;margin-bottom: 0px;margin-right: 0px; margin-left: 0px;">
								    <label class="col-lg-3 col-md-3 col-sm-2 control-label" style="padding-top: 3px;padding-right: 0px;padding-left: 0px;text-align: right;">
									分类</label>
								    <div class="col-lg-9 col-md-9 col-sm-10">
									    <select class="form-control select intype" id="type" name="type">
										</select>
								    </div>
							    </div>
								<div class="form-group in-filter row col-lg-4 col-md-4 col-sm-12" 
									 style="border-bottom: 0px;padding-bottom: 0px;margin-bottom: 0px;margin-right: 0px; margin-left: 0px;">
								    <label class="col-lg-3 col-md-3 col-sm-2 control-label" style="padding-top: 3px;padding-right: 0px;padding-left: 0px;text-align: right;">
									账户</label>
								    <div class="col-lg-9 col-md-9 col-sm-10">
									    <select class="form-control select accounttype" id="account" name="account">
										</select>
								    </div>
							    </div>
								<div class="form-group in-filter row col-lg-4 col-md-4 col-sm-12" 
									 style="border-bottom: 0px;padding-bottom: 0px;margin-bottom: 0px;margin-right: 0px; margin-left: 0px;">
								    <label class="col-lg-3 col-md-3 col-sm-2 control-label" style="padding-top: 3px;padding-right: 0px;padding-left: 0px;text-align: right;">
									金额</label>
								    <div class="col-lg-9 col-md-9 col-sm-10">
										<div class="input-group">
											<span style="padding:0px 7px;" class="input-group-addon">￥</span>
											<input type="text" class="form-control" id="money" name="money">
										</div>
									</div>
							    </div>
								<div class="form-group in-filter row col-lg-4 col-md-4 col-sm-12" 
									 style="border-bottom: 0px;padding-bottom: 0px;margin-bottom: 0px;margin-right: 0px; margin-left: 0px;">
								    <label class="col-lg-3 col-md-3 col-sm-2 control-label" style="padding-top: 3px;padding-right: 0px;padding-left: 0px;text-align: right;">
									成员</label>
								    <div class="col-lg-9 col-md-9 col-sm-10">
									    <select class="form-control select membertype" id="member" name="member">
										</select>
								    </div>
							    </div>
								<div class="form-group in-filter row col-lg-4 col-md-4 col-sm-12" 
									 style="border-bottom: 0px;padding-bottom: 0px;margin-bottom: 0px;margin-right: 0px; margin-left: 0px;">
								    <label class="col-lg-3 col-md-3 col-sm-2 control-label" style="padding-top: 3px;padding-right: 0px;padding-left: 0px;text-align: right;">
									时间</label>
								    <div class="col-lg-9 col-md-9 col-sm-10 ">
										<div class="input-group">
											<input type="text" class="form-control" id="time" name="time">
											<span style="padding:0px 7px;" class="input-group-addon">
												<label for="time"><i class="fa fa-calendar"></i></label>
											</span>
										</div>
									</div>
							    </div>
								<div class="form-group row in-filter col-lg-12 col-md-12 col-sm-12" 
									 style="border-bottom: 0px;padding-bottom: 0px;margin-bottom: 0px;margin-right: 0px; margin-left: 0px;">
									<label class="col-lg-1 col-md-1 col-sm-2 control-label" style="padding-top: 3px;padding-right: 0px;padding-left: 0px;text-align: right;">
									备注</label>
									<div class="col-lg-11 col-md-11 col-sm-10">
										<input type="text" class="form-control" id="remark" name="remark">
									</div>
								</div>
								<div class="col-lg-12 col-md-12 col-sm-12" style="position:relative;height:40px;" >
									<button type="button" class="btn btn-warning save-in" onclick="save()">保存</button>
								</div>
							</div>
                        </form>
						<hr><!-- 条件填写完成-->
						<div class="row" style="padding:20px;">
							<div class="row col-lg-6 col-md-6 col-sm-12" style="position:relative;height:50px;">
								<div class="col-lg-4 col-md-4 col-sm-3">
									<h4>收入清单</h4>
								</div>
								<div class="col-lg-8 col-md-8 col-sm-9" style="position:absolute;right:25px;bottom:20px;">
									<b></b>
								</div>
							</div>
							<div class="row col-lg-6 col-md-6 col-sm-12" style="position:relative;height:50px;">
								<div class="" style="position:absolute;right:40px;bottom:20px;">
									<b></b>
								</div>
							</div>
							<div class="row col-lg-12 col-md-12 col-sm-12" style="margin:0px;">
							<table id="example" class="display table table-hover table-striped table-bordered" cellspacing="0" width="100%">
								<thead>
									<tr>
										<th>收入类型</th>
										<th>账户</th>
										<th>时间</th>
										<th>金额</th>
										<th>成员</th>
										<th>备注</th>
									</tr>
									<tr>
										<th> </th>
										<th> </th>
										<th> </th>
										<th> </th>
										<th> </th>
										<th> </th>
									</tr>
								</thead>
								<tfoot>
									<tr>
										<th colspan="6" style="text-align:right">Total:</th>
									</tr>
								</tfoot>
								<tbody>
									<tr>
										<td>工资</td>
										<td>信用卡</td>
										<td>2017-03-15 10:54:00</td>
										<td>￥8,000</td>
										<td>本人</td>
										<td>挣钱啦</td>
									</tr>
									<tr>
										<td>工资</td>
										<td>信用卡</td>
										<td>2017-03-15 10:54:00</td>
										<td>￥8,000</td>
										<td>本人</td>
										<td>挣钱啦</td>
									</tr>
									<tr>
										<td>工资</td>
										<td>信用卡</td>
										<td>2017-03-15 10:54:00</td>
										<td>￥8,000</td>
										<td>本人</td>
										<td>挣钱啦</td>
									</tr>
									<tr>
										<td>工资</td>
										<td>信用卡</td>
										<td>2017-03-15 10:54:00</td>
										<td>￥8,000</td>
										<td>本人</td>
										<td>挣钱啦</td>
									</tr>
									<tr>
										<td>工资</td>
										<td>信用卡</td>
										<td>2017-03-15 10:54:00</td>
										<td>￥8,000</td>
										<td>本人</td>
										<td>挣钱啦</td>
									</tr><tr>
										<td>工资</td>
										<td>信用卡</td>
										<td>2017-03-15 10:54:00</td>
										<td>￥8,000</td>
										<td>本人</td>
										<td>挣钱啦</td>
									</tr><tr>
										<td>工资</td>
										<td>信用卡</td>
										<td>2017-03-15 10:54:00</td>
										<td>￥8,000</td>
										<td>本人</td>
										<td>挣钱啦</td>
									</tr><tr>
										<td>工资</td>
										<td>信用卡</td>
										<td>2017-03-15 10:54:00</td>
										<td>￥8,000</td>
										<td>本人</td>
										<td>挣钱啦</td>
									</tr><tr>
										<td>工资</td>
										<td>信用卡</td>
										<td>2017-03-15 10:54:00</td>
										<td>￥8,000</td>
										<td>本人</td>
										<td>挣钱啦</td>
									</tr>
								</tbody>
							</table>
							</div>
						</div>
                    </div>
          		</div>    	
          	</div>
		</section>
    </section>
	<script type="text/javascript">
		//提交
		function save(){
			var type = $("#type").val();
			var account = $("#account").val();
			var money = $("#money").val();
			var time = $("#time").val();
			var member = $("#member").val();
			var remark = $("#remark").val();
			$.ajax({
				type: "post",
				url: '/index/account/set_income',
				dataType: "json",
                data: {type:type,account:account,money:money,time:time,member:member,remark:remark},
                cache: true,
				async: false,
				success: function (msg) {
					if(msg.success){
						console.log(msg);
					}
				},
				error: function (e) {
					console.log(e);
				}
			});
		}
		$(document).ready(function() {			
			//获取收入分类
			$.ajax({
				type: "get",
				url: '/index/account/in_type',
				async: false,
				success: function (msg) {
					if(msg.success){
						var in_type = JSON.parse(msg.data.type);
						var typeStr = "";
						in_type.type.forEach(function(item){
							typeStr += "<option>"+ item +"</option>";
						});
						$(".intype").html(typeStr);
					}
				},
				error: function (e) {
					console.log(e);
				}
			});
			//获取收入分类
			$.ajax({
				type: "get",
				url: '/index/account/account_type',
				async: false,
				success: function (msg) {
					if(msg.success){
						var account_type = JSON.parse(msg.data.type);
						var typeStr = "";
						account_type.type.forEach(function(item){
							typeStr += "<option>"+ item +"</option>";
						});
						$(".accounttype").html(typeStr);
					}
				},
				error: function (e) {
					console.log(e);
				}
			});
			//获取成员
			$.ajax({
				type: "get",
				url: '/index/account/member_type',
				async: false,
				success: function (msg) {
					if(msg.success){
						var member_type = JSON.parse(msg.data.type);
						var typeStr = "";
						member_type.type.forEach(function(item){
							typeStr += "<option>"+ item +"</option>";
						});
						$(".membertype").html(typeStr);
					}
				},
				error: function (e) {
					console.log(e);
				}
			});
			$('#time').datetimepicker({
				format: 'yyyy-mm-dd hh:ii',
				language:'zh-CN',
				todayBtn:'linked'
			});
			var table = $('#example').dataTable({
				"dom": '<"toolbar">lfrtip<"clear">',
				"lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
				"scrollX": true,
				"pagingType":   "full_numbers",
				"language": {
					"url": "/dist/i18n/Chinese.json"
				},
				"ordering": false, // 禁止排序
				"footerCallback": function ( row, data, start, end, display ) {
					var api = this.api(), data;
					var intVal = function ( i ) {
						return typeof i === 'string' ?
							i.replace(/[\￥,]/g, '')*1 :
							typeof i === 'number' ?
								i : 0;
					};
					total = api
						.column( 3 )
						.data()
						.reduce( function (a, b) {
							return intVal(a) + intVal(b);
						} );
					pageTotal = api
						.column( 3, { page: 'current'} )
						.data()
						.reduce( function (a, b) {
							return intVal(a) + intVal(b);
						}, 0 );
					$( api.column( 3 ).footer() ).html(
						'本页收入：￥'+pageTotal +' ( 共收入：￥'+ total +')'
					);
				},
				initComplete: function () {
					var api = this.api();
					api.columns().indexes().flatten().each( function ( i ) {
						var column = api.column( i );
						var select = $('<select class="form-control select"><option value=""></option></select>')
							.appendTo( $(column.header()).empty() )
							.on( 'change', function () {
								var val = $.fn.dataTable.util.escapeRegex(
									$(this).val()
								);
								column
									.search( val ? '^'+val+'$' : '', true, false )
									.draw();
							} );
						column.data().unique().sort().each( function ( d, j ) {
							select.append( '<option value="'+d+'">'+d+'</option>' )
						} );
					} );
				}
			}).on( 'init.dt', function () {	
				$(".dataTables_length").css("display","inline-block");
				$(".dataTables_filter").css("display","inline-block");
				$(".dataTables_info").css("display","inline-block");
				$(".dataTables_paginate").css("display","inline-block");
				$(".dataTables_paginate").css("float","right");
				$(".dataTables_filter").css("float","right");
				$(".dataTables_length label select").css("padding","0px");
				$(".dataTables_length label select").css("height","26px");
				$(".dataTables_length label select").css("width","55px");
				$(".toolbar").addClass('toolbar');
				$(".toolbar").html('<button id="delete" type="button" class="btn btn-primary btn-xs"><i class="fa fa-trash-o fa-lg"></i> 删除所选</button>');
				$('#delete').click( function () {
					console.log($("#example tbody ").find('.warning'));
				} );
			});
			
			$('#example tbody').on( 'click', 'tr', function () {
				$(this).toggleClass('warning');
			} );
		});	
	</script>